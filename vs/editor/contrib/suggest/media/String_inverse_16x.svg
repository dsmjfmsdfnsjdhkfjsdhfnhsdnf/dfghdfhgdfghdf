tShellConfig},e.prototype.buildAccessTokenResponse=function(e){if(!this.checkWamTokenResult(e))return null;var t=e.responseData[0],n=t.webAccount.webAccountProvider,r=t.properties&&t.properties.hasKey("exp")&&1e3*parseInt(t.properties.lookup("exp")),o=this.isConsumerAuthority(n.authority);return{success:!0,token:e.responseData[0].token,expiryMs:r||!o&&this.getDefaultExpiry(),format:n&&o?"RPSCompact":"JWT",source:"WAM"}},e.prototype.getDefaultExpiry=function(){return(new Date).getTime()+r.a},e.prototype.isAsianCulture=function(e){return!!e&&["ja","ko","zh"].some(function(t){return 0===e.indexOf(t)})},e.prototype.getUserDisplayName=function(e){var t="";if(this.currentUserAccount){var n=this.currentUserAccount.properties.hasKey("FirstName")?this.currentUserAccount.properties.lookup("FirstName"):"",r=this.currentUserAccount.properties.hasKey("LastName")?this.currentUserAccount.properties.lookup("LastName"):"";t=n&&r?this.isAsianCulture(e)?r+n:n+" "+r:n||r||this.currentUserAccount.userName}return t},e.prototype.getUserIdKey=function(e,t){return e+"_"+t},e.prototype.getCurrentAccount=function(t){var n=this;return this.currentUserAccount?Promise.resolve(this.currentUserAccount):t&&this.localSettingsProps.hasKey(e.CurrentAccountIdKey)?this.findAccountAsync(t).then(function(e){return n.currentUserAccount=e,n.getCurrentUserPhoto(),e}):Promise.reject()},e.prototype.findAccountAsync=function(t){var n=this,o=r.d.CurrentTime(),i=function(e,t){n.logRequest("FindAccount_Request",Math.ceil(r.d.CurrentTime()-o),e,2,!1,t)};return new Promise(function(r,o){Windows.Security.Authentication.Web.Core.WebAuthenticationCoreManager.findAccountAsync(t,n.localSettingsProps.lookup(e.CurrentAccountIdKey)).then(r,o)}).then(function(e){return i(!0),Promise.resolve(e)},function(e){return i(!1,e),Promise.reject(e)})},e.prototype.cleanUpShellAndConfigCallbacks=function(){this.shellAndConfigPromiseResolver=null,this.shellAndConfigPromiseRejecter=null},e.prototype.logAriaEvent=function(e,t,n,o,i){o=o||{},this.currentAccountProvider&&(o.AuthType=this.isConsumerAuthority(this.currentAccountProvider.authority)?"MSA":"OrgId"),r.d.LogEvent(e,t,n,o,i)},e.prototype.logRequest=function(e,t,n,o,i,a,s){(s=s||{}).Latency=t.toString(),s.State=n?"Succeeded":"Failed",s.FromServiceWorkerCache=(!!i).toString(),a&&(s.Error=a.toString()),this.logAriaEvent(r.d.GenericRequest,e,o,s)},e.prototype.markPerformance=function(t,n,o){r.d.MarkPerformance(t,o,n,window.windowsDataSecuritySetting,{Page:e.PwaPage})},e.prototype.checkWamTokenResult=function(e){return e&&e.responseStatus===Windows.Security.Authentication.Web.Core.WebTokenRequestStatus.success&&e.responseData&&e.responseData.length>0},e.prototype.getWamTokenResult=function(t,n,o,i){var a,s=this,c=r.d.CurrentTime(),u="";if(this.isConsumerAuthority(o.authority))a=new Windows.Security.Authentication.Web.Core.WebTokenRequest(o,n,"none");else{var d=t===e.OfficeApiResource?"openid":"";(a=new Windows.Security.Authentication.Web.Core.WebTokenRequest(o,d,"0ec893e0-5785-4de6-99da-4ed124e5296c")).properties.insert("resource",n)}var l=new Promise(function(n,r){if(!a)return u="InvalidTokenRequest",void r();var i=function(e){s.getWamToken(t,e).then(n,r)};s.localSettingsProps.hasKey(e.SwitchAccountKey)?i(a):s.getCurrentAccount(o).then(function(e){return s.getWamTokenSilently(t,a,e)}).then(function(e){n(e)}).catch(function(){i(a)})}),p=!0;if(l.catch(function(){p=!1}).then(function(){var e={Resource:t};s.logRequest("GetWamTokenResult_Request",Math.ceil(r.d.CurrentTime()-c),p,0,!1,u,e)}),i){var h={pending:!0,result:l.then(function(e){return s.buildAccessTokenResponse(e)})};window.wamAccessTokenRequests.set(n,h)}return l},e.prototype.getWamToken=function(t,n){var o=this,i=new Promise(function(t,i){Windows.Security.Authentication.Web.Core.WebAuthenticationCoreManager.requestTokenAsync(n).then(function(n){if(n&&n.responseStatus===Windows.Security.Authentication.Web.Core.WebTokenRequestStatus.userCancel&&o.userInteractionRequired){if(o.isUserInteractionErrorHandled)return;if(e.SessionExpiredToastMessage)try{var i=new Windows.Data.Xml.Dom.XmlDocument;i.loadXml(e.SessionExpiredToastMessage);var a=new Windows.UI.Notifications.ToastNotification(i);Windows.UI.Notifications.ToastNotificationManager.createToastNotifier().show(a),o.logAriaEvent(r.d.GenericEvent,"UserSessionExpired",0)}catch(e){o.logAriaEvent(r.d.GenericEvent,"CreateSessionExpiredToast_Error",0,{Error:"string"==typeof e?e:e?e.message:""})}else o.logAriaEvent(r.d.GenericEvent,"MissingSessionExpiredToastMessage",0);o.isUserInteractionErrorHandled=!0,window.uwpSignOut()}else t(n)},i)});return this.instrumentedTokenFetch(i,"GetWamToken_Request",t)},e.prototype.getWamTokenSilently=function(e,t,n){var r=this,o=new Promise(func